---

# Armv7l

- name: Ensure build dir
  file:
    path: "{{docker_conf_path}}/Build/swarmprom/caddy"
    state: directory
    recurse: yes
  tags:
    - sp_caddy-dir

# - name: Download Armv7l Caddy binary
#   get_url:
#     url: https://caddyserver.com/download/linux/arm7?plugins=http.ipfilter,http.prometheus&license=personal&telemetry=off
#     dest: "{{docker_conf_path}}/Build/swarmprom/caddy"
#   tags:
#     - sp_caddy-dl

- name: Get the latest Armv7l Caddy release information from Github
  uri:
    url: https://caddyserver.com/download/linux/arm7?plugins=http.ipfilter,http.prometheus&license=personal&telemetry=off
    method: GET
    dest: "{{docker_conf_path}}/Build/swarmprom/caddy"
  register: _caddy_github_release
  until: _caddy_github_release.status == 200
  retries: 5
  delay: 15
  tags:
    - sp_caddy-dl

- name: Get the latest amd64 Caddy release information from Github
  uri:
    url: https://caddyserver.com/download/linux/amd64?plugins=http.ipfilter,http.prometheus&license=personal&telemetry=off
    method: GET
    dest: "{{docker_conf_path}}/Build/swarmprom/caddy"
  register: _caddy_github_release
  until: _caddy_github_release.status == 200
  retries: 5
  delay: 15
  tags:
    - sp_caddy-dl

# - name: Unarchive Armv7l source
#   unarchive:
#     src:
#     dest: